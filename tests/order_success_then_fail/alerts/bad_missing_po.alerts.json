{
  "po_number": null,
  "status": "FAILED",
  "reasons": [
    "task_execution_failed"
  ],
  "fields": {
    "email": {
      "subject": "Purchase Order - Missing PO Number",
      "from": "qa.team@example.com",
      "to": "orders@yourmfg.com",
      "date": "Thu, 19 Feb 2026 10:05:00 -0500"
    },
    "message_intro": [
      "Hello,",
      "Please process this purchase order."
    ],
    "purchase_order": {
      "po_number": null,
      "vendor": "Broken Vendor Inc.",
      "ship_to": {
        "name": "Shared Warehouse",
        "address_lines": [
          "10 Demo Way",
          "Nashville, TN 37201"
        ],
        "full": "Shared Warehouse, 10 Demo Way, Nashville, TN 37201"
      },
      "order_date": "2026-02-19",
      "due_date": "2099-12-31",
      "payment_terms": "Net 30",
      "line_items": [
        {
          "item_no": 1,
          "description": "Broken Labels",
          "qty": 100,
          "unit_price": 1.0,
          "total": 100.0
        }
      ],
      "totals": {
        "subtotal": 100.0,
        "tax": {
          "rate": "0.00%",
          "amount": 0.0
        },
        "shipping": 5.0,
        "total": 105.0
      },
      "notes": [
        "This file intentionally omits PO Number and should fail DB upsert."
      ],
      "contact": {
        "name": "QA Team",
        "title": "Procurement Analyst",
        "company": null,
        "phone": null,
        "email": null,
        "raw_lines": [
          "QA Team",
          "Procurement Analyst"
        ]
      }
    }
  },
  "timestamp": "2026-02-19T21:57:58.642406+00:00",
  "error": "null value in column \"po_number\" of relation \"purchase_orders\" violates not-null constraint\nDETAIL:  Failing row contains (32, null, Broken Vendor Inc., Shared Warehouse, Shared Warehouse, 10 Demo Way, Nashville, TN 37201, 2026-02-19, 2099-12-31, Net 30, 100.00, 0.00%, 0.00, 5.00, 105.00, Purchase Order - Missing PO Number, qa.team@example.com, orders@yourmfg.com, Thu, 19 Feb 2026 10:05:00 -0500, f, {\"This file intentionally omits PO Number and should fail DB ups..., QA Team, Procurement Analyst, null, null, null, {\"email\": {\"to\": \"orders@yourmfg.com\", \"date\": \"Thu, 19 Feb 2026..., 2026-02-19 21:57:58.598648+00, 2026-02-19 21:57:58.598648+00).\nCONTEXT:  SQL statement \"INSERT INTO purchase_orders (\n        po_number,\n        vendor,\n        ship_to_name,\n        ship_to_address,\n        order_date,\n        due_date,\n        payment_terms,\n        subtotal,\n        tax_rate,\n        tax_amount,\n        shipping_amount,\n        total_amount,\n        subject,\n        sender_email,\n        recipient_email,\n        email_date,\n        is_urgent,\n        notes,\n        contact_name,\n        contact_title,\n        contact_company,\n        contact_phone,\n        contact_email,\n        raw_payload\n    )\n    VALUES (\n        payload #>> '{purchase_order,po_number}',\n        payload #>> '{purchase_order,vendor}',\n        payload #>> '{purchase_order,ship_to,name}',\n        payload #>> '{purchase_order,ship_to,full}',\n        NULLIF(payload #>> '{purchase_order,order_date}', '')::date,\n        NULLIF(payload #>> '{purchase_order,due_date}', '')::date,\n        payload #>> '{purchase_order,payment_terms}',\n        NULLIF(payload #>> '{purchase_order,totals,subtotal}', '')::numeric,\n        payload #>> '{purchase_order,totals,tax,rate}',\n        NULLIF(payload #>> '{purchase_order,totals,tax,amount}', '')::numeric,\n        NULLIF(payload #>> '{purchase_order,totals,shipping}', '')::numeric,\n        NULLIF(payload #>> '{purchase_order,totals,total}', '')::numeric,\n        payload #>> '{email,subject}',\n        payload #>> '{email,from}',\n        payload #>> '{email,to}',\n        payload #>> '{email,date}',\n        POSITION('urgent' IN LOWER(COALESCE(payload #>> '{email,subject}', ''))) > 0,\n        COALESCE(ARRAY(SELECT jsonb_array_elements_text(payload #> '{purchase_order,notes}')), '{}'),\n        payload #>> '{purchase_order,contact,name}',\n        payload #>> '{purchase_order,contact,title}',\n        payload #>> '{purchase_order,contact,company}',\n        payload #>> '{purchase_order,contact,phone}',\n        payload #>> '{purchase_order,contact,email}',\n        payload\n    )\n    ON CONFLICT (po_number) DO UPDATE\n    SET\n        vendor = EXCLUDED.vendor,\n        ship_to_name = EXCLUDED.ship_to_name,\n        ship_to_address = EXCLUDED.ship_to_address,\n        order_date = EXCLUDED.order_date,\n        due_date = EXCLUDED.due_date,\n        payment_terms = EXCLUDED.payment_terms,\n        subtotal = EXCLUDED.subtotal,\n        tax_rate = EXCLUDED.tax_rate,\n        tax_amount = EXCLUDED.tax_amount,\n        shipping_amount = EXCLUDED.shipping_amount,\n        total_amount = EXCLUDED.total_amount,\n        subject = EXCLUDED.subject,\n        sender_email = EXCLUDED.sender_email,\n        recipient_email = EXCLUDED.recipient_email,\n        email_date = EXCLUDED.email_date,\n        is_urgent = EXCLUDED.is_urgent,\n        notes = EXCLUDED.notes,\n        contact_name = EXCLUDED.contact_name,\n        contact_title = EXCLUDED.contact_title,\n        contact_company = EXCLUDED.contact_company,\n        contact_phone = EXCLUDED.contact_phone,\n        contact_email = EXCLUDED.contact_email,\n        raw_payload = EXCLUDED.raw_payload\n    RETURNING id\"\nPL/pgSQL function upsert_purchase_order(jsonb) line 5 at SQL statement"
}